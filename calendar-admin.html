<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Admin - RCTC CS Club</title>
</head>
<body>
    <h1>Calendar Event Manager</h1>
    <p><a href="calendar.html">‚Üê Back to Calendar</a></p>
    
    <hr>
    
    <h2>Add New Event</h2>
    <form id="eventForm">
        <table>
            <tr>
                <td><label for="title">Event Title:</label></td>
                <td><input type="text" id="title" required style="width: 300px;"></td>
            </tr>
            <tr>
                <td><label for="start">Start Date & Time:</label></td>
                <td><input type="datetime-local" id="start" required></td>
            </tr>
            <tr>
                <td><label for="end">End Date & Time:</label></td>
                <td><input type="datetime-local" id="end" required></td>
            </tr>
            <tr>
                <td><label for="category">Category:</label></td>
                <td>
                    <select id="category" required>
                        <option value="workshop">Workshop</option>
                        <option value="hackathon">Hackathon</option>
                        <option value="social">Social</option>
                        <option value="meeting">Meeting</option>
                        <option value="deadline">Deadline</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label for="location">Location:</label></td>
                <td><input type="text" id="location" style="width: 300px;"></td>
            </tr>
            <tr>
                <td><label for="description">Description:</label></td>
                <td><textarea id="description" rows="4" style="width: 300px;"></textarea></td>
            </tr>
            <tr>
                <td></td>
                <td><button type="submit">Add Event</button></td>
            </tr>
        </table>
    </form>
    
    <hr>
    
    <h2>Current Events (<span id="eventCount">0</span>)</h2>
    <button onclick="refreshEventList()">Refresh List</button>
    <button onclick="clearAllEvents()" style="color: red;">Clear All Events</button>
    
    <div id="eventsList"></div>

    <script>
        // Load existing events from localStorage
        function loadEvents() {
            const stored = localStorage.getItem('calendarEvents');
            if (stored) {
                return JSON.parse(stored).map(event => ({
                    ...event,
                    start: new Date(event.start),
                    end: new Date(event.end)
                }));
            }
            return [];
        }

        function saveEvents(events) {
            localStorage.setItem('calendarEvents', JSON.stringify(events));
        }

        // Add event form handler
        document.getElementById('eventForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const events = loadEvents();
            
            const event = {
                id: Date.now(),
                title: document.getElementById('title').value,
                start: new Date(document.getElementById('start').value),
                end: new Date(document.getElementById('end').value),
                category: document.getElementById('category').value,
                location: document.getElementById('location').value,
                description: document.getElementById('description').value
            };
            
            // Validate dates
            if (event.end <= event.start) {
                alert('End time must be after start time!');
                return;
            }
            
            events.push(event);
            saveEvents(events);
            
            alert('Event added successfully!');
            e.target.reset();
            refreshEventList();
        });

        // Display all events
        function refreshEventList() {
            const events = loadEvents();
            const container = document.getElementById('eventsList');
            document.getElementById('eventCount').textContent = events.length;
            
            if (events.length === 0) {
                container.innerHTML = '<p><em>No events added yet.</em></p>';
                return;
            }
            
            // Sort events by start date
            events.sort((a, b) => new Date(a.start) - new Date(b.start));
            
            let html = '<table border="1" cellpadding="10" style="width: 100%; margin-top: 20px;">';
            html += '<tr><th>Date</th><th>Title</th><th>Time</th><th>Category</th><th>Location</th><th>Actions</th></tr>';
            
            events.forEach(event => {
                const startDate = new Date(event.start);
                const endDate = new Date(event.end);
                
                html += '<tr>';
                html += `<td>${startDate.toLocaleDateString()}</td>`;
                html += `<td><strong>${event.title}</strong><br><small>${event.description || 'No description'}</small></td>`;
                html += `<td>${startDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${endDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>`;
                html += `<td>${event.category}</td>`;
                html += `<td>${event.location || '-'}</td>`;
                html += `<td><button onclick="deleteEvent(${event.id})">Delete</button></td>`;
                html += '</tr>';
            });
            
            html += '</table>';
            container.innerHTML = html;
        }

        // Delete single event
        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                let events = loadEvents();
                events = events.filter(e => e.id !== eventId);
                saveEvents(events);
                alert('Event deleted!');
                refreshEventList();
            }
        }

        // Clear all events
        function clearAllEvents() {
            if (confirm('Are you sure you want to delete ALL events? This cannot be undone!')) {
                if (confirm('Really delete everything? This is your last warning!')) {
                    localStorage.removeItem('calendarEvents');
                    alert('All events cleared!');
                    refreshEventList();
                }
            }
        }

        // Load events on page load
        refreshEventList();

        // Auto-set current date/time as default
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('start').value = now.toISOString().slice(0, 16);
        
        const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);
        document.getElementById('end').value = oneHourLater.toISOString().slice(0, 16);
    </script>
</body>
</html>